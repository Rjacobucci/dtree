{
    "collab_server" : "",
    "contents" : "#' Main function for creating different types of decision trees\n#'\n#' @param formula a formula, weight a response to left of ~.\n#' @param data Data frame to run models on\n#' @param methods Which tree methods to use. Defaults:\n#'        lm, rpart, tree, ctree, evtree. Also can use \"rf\" for random forests\n#' @param weights Optional weights for each case.\n#' @param perc.sub What fraction of data to put into train dataset. 1-frac.sub\n#'        is allocated to test dataset. Defaults to 0.75\n#' @param prune Whether to prune rpart tree\n#'\n#'\n#' @importFrom stats cor fitted lm predict terms glm binomial\n#' @import party rpart evtree caret\n#' @export\n#'\n#' @examples\n#' # continuous outcome\n#' library(MASS) # for boston data\n#' data(Boston)\n#' out <- dtree(medv ~., data=Boston,methods=c(\"lm\",\"rpart\",\"ctree\"))\n#' summary(out)\n#' plot(out$rpart.out)\n#'\n#' # categorical outcome\n#' library(ISLR)\n#' data(Default)\n#'\n#' out <- dtree(default ~ ., data=Default,methods=c(\"lm\",\"rpart\"))\n#' summary(out)\n\n\ndtree = function(formula,\n                 data,\n                 methods=c(\"lm\",\"rpart\",\"tree\",\"ctree\",\"evtree\"),\n                 weights,\n                 perc.sub=.75,\n                 prune=TRUE){\n\n  ret <- list()\n\n  ids <- sample(nrow(data),nrow(data)*perc.sub)\n  data.train <- data[ids,]\n  data.test <- data[-ids,]\n\n\n\n  getResponseFormula <- function (object)\n  {\n    form <- formula(object)\n    if (!(inherits(form, \"formula\") && (length(form) == 3))) {\n      stop(\"'form' must be a two-sided formula\")\n    }\n    eval(parse(text = paste(\"~\", deparse(form[[2]]))))\n  }\n\n  response <- attr(terms(getResponseFormula(formula)),\"term.labels\")\n  # ------------------------------------------------------------------\n\n\n  class.response <- class(data.train[,response])\n\n\n  if(class.response == \"numeric\" | class.response == \"integer\"){\n    return.matrix <- matrix(NA,length(methods),8)\n    rownames(return.matrix) <- methods\n    colnames(return.matrix) <- c(\"nodes\",\"nvar\",\"nsplits\",\"misfit.cv\",\n                                 \"misfit.train\",\"rsq.train\",\"misfit.test\",\"rsq.test\")\n  }else{\n    return.matrix <- matrix(NA,length(methods),6)\n    rownames(return.matrix) <- methods\n    colnames(return.matrix) <- c(\"nodes\",\"nvar\",\"nsplits\",\"accuracy.cv\",\n                                 \"accuracy.train\",\"accuracy.test\")\n  }\n\n\n  # -----------------------------------------------------------------\n\n  # Linear (Logistic) Regression\n\n  # -----------------------------------------------------------------\n\n  if(any(methods==\"lm\")){\n\n    ret0 <- lm_ret(formula, data.train,data.test,class.response,response)\n    return.matrix[\"lm\",] <- ret0$vec\n    ret$lm.out <- ret0$lm.ret\n\n\n\n  }\n\n\n\n  # ------------------------------------------------------------------\n\n  # Rpart\n\n  # ----------------------------------------------------------------\n\n\n  if(any(methods==\"rpart\")){\n\n  ret1 <- rpart_ret(formula, data.train,data.test, prune, class.response,response)\n  return.matrix[\"rpart\",] <- ret1$vec\n  ret$rpart.out <- ret1$rpart.ret\n\n\n\n  }\n\n  # --------------------------------------------------\n\n  # Tree\n\n  # --------------------------------------------------\n\n  if(any(methods == \"tree\")){\n\n    ret1 <- tree_ret(formula, data.train,data.test, prune, class.response,response)\n    return.matrix[\"tree\",] <- ret1$vec\n    ret$tree.out <- ret1$tree.ret\n\n\n\n  }\n\n  # ----------------------------------------------------\n\n  # Ctree\n\n  # ----------------------------------------------------\n\n  if(any(methods == \"ctree\")){\n    ret3 <- ctree_ret(formula, data.train,data.test, class.response,response)\n    return.matrix[\"ctree\",] <- ret3$vec\n    ret$ctree.out <- ret3$ctree.ret\n  }\n\n\n  #----------------------------------------------------\n\n  # Evtree\n\n  # ---------------------------------------------------\n\n  if(any(methods == \"evtree\")){\n    ret4 <- evtree_ret(formula, data.train,data.test, class.response,response)\n    return.matrix[\"evtree\",] <- ret4$vec\n    ret$evtree.out <- ret4$evtree.ret\n  }\n\n  #----------------------------------------------------\n\n  # Random Forests\n\n  # ---------------------------------------------------\n\n  if(any(methods == \"rf\")){\n    ret5 <- rf_ret(formula, data.train,data.test, class.response,response)\n    return.matrix[\"rf\",] <- ret5$vec\n    ret$rf.out <- ret5$rf.ret\n  }\n\n\n\n  ret$response.type <- class.response\n  ret$return.matrix <- return.matrix\n  ret$call <- match.call()\n  class(ret) <- \"dtree\"\n  return(ret)\n\n}\n",
    "created" : 1481645641848.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2664427530",
    "id" : "2AB859A9",
    "lastKnownWriteTime" : 1484099415,
    "last_content_update" : 1484099415,
    "path" : "~/GitHub/dtree/R/dtree.R",
    "project_path" : "R/dtree.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}