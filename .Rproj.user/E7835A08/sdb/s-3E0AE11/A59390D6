{
    "collab_server" : "",
    "contents" : "library(caret);library(randomForest)\n\n\n# read in data\n# need foreign package to read spss data files\n#install.packages(\"foreign\")\nlibrary(foreign)\n\n\n# Screener Database_Downloaded_11.2.16_OnlyNSSI for RF_Only RF Variables for Ross\ndat <- read.spss(file.choose(),to.data.frame=TRUE) \nhead(dat)\ndat$NSSI_Hx <- as.factor(dat$NSSI_Hx)\ndat$NSSI_LastYr <- as.factor(dat$NSSI_LastYr)\ndat$Age <- as.numeric(as.character(dat$Age))\ndat2 <- dat[complete.cases(dat),-1]\n\n##### unlike most packages, caret automatically creates separate variables for factors\n##### no need to create dummy coded variables for predictors as a result\n\n\ndat.mod1 <- dat2[,-55]\ndat.mod2 <- dat2[,-54]\nlevels(dat.mod2$NSSI_LastYr) <- c(\"No\",\"Yes\")\n\n\n\nlibrary(doParallel)\n#cl <- makeCluster(detectCores())\ncl <- makeCluster(7)\nregisterDoParallel(cl)\n\n#wgt <- ifelse(dat.mod2$NSSI_LastYr==0,.16,.84)\n\n\n\n# Kappa\n## For accuracy, Kappa, the area under the ROC curve,\n## sensitivity and specificity:\nfiveStats <- function(...) c(twoClassSummary(...),\n                             + defaultSummary(...))\n## Everything but the area under the ROC curve:\nfourStats <- function (data, lev = levels(data$obs), model = NULL)\n{\n  \n  accKapp<-postResample(data[,\"pred\"],data[,\"obs\"])\n  out<-c(accKapp,\n         sensitivity(data[, \"pred\"], data[, \"obs\"], lev[1]),\n         specificity(data[, \"pred\"], data[, \"obs\"], lev[2]))\n  names(out)[3:4]<-c(\"Sens\",\"Spec\")\n  out\n}\n\n# ROC as evaluation\nrf.out2 <- train(NSSI_LastYr ~ ., data=dat.mod2,method=\"rf\",importance=TRUE,ntree=1000,metric=\"ROC\",\n                    trControl=trainControl(method=\"repeatedcv\",repeats=20,classProbs = TRUE,\n                                           summaryFunction = fiveStats,\n                                           verboseIter = TRUE),tuneLength=5)\nrf.out2\n\nplot(rf.out2)\nvarImp(rf.out2)\nplot(varImp(rf.out2))\n\n\n\n\n### ------------------------------------------------------------------------------\n\n# Last year elastic net\n\n### -----------------------------------------------------------------------------\n\n\n\n\n# Accuracy\nenet.out2 <- train(NSSI_LastYr ~ ., data=dat.mod2,method=\"glmnet\",metric=\"ROC\",\n                      trControl=trainControl(method=\"repeatedcv\",repeats=20,classProbs = TRUE,\n                                             summaryFunction = fiveStats,\n                                             verboseIter = TRUE),tuneLength=10)\nplot(enet.out2)\nenet.out2$bestTune[2]\ncoef(enet.out2$finalModel,as.numeric(enet.out2$bestTune[2]))\n\n\n\n\n\n\n# save workspace\nsave.image(\"taylor_abct_mod2.Rdata\")\n",
    "created" : 1490137677521.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1029296763",
    "id" : "A59390D6",
    "lastKnownWriteTime" : 1488840594,
    "last_content_update" : 1488840594,
    "path" : "C:/Users/RJacobucci/Dropbox/taylor_rf/PROJECT2/script1_2ndRF.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 12,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}