{
    "collab_server" : "",
    "contents" : "#' Main function to calculate stability coefficients\n#'\n#' @param formula a formula, weight a response to left of ~.\n#' @param data Data frame to run models on\n#' @param methods Which tree methods to use. Defaults:\n#'        lm, rpart, tree, ctree, evtree. Also can use \"rf\" for random forests\n#' @param samp.method Sampling method. Refer to caret package trainControl()\n#'        documentation. Default is repeated cross-validation. Other options\n#'        include \"cv\" and \"boot\".\n#' @param tuneLength Number of tuning parameters to try. Applies to train()\n#' @param n.rep Number of times to replicate each method\n#' @param stablelearner Whether or not to use the stablelearner package to\n#'        calculate stability\n#' @param subset Whether to subset\n#' @param perc.sub What fraction of data to put into train dataset. 1-frac.sub\n#'        is allocated to test dataset. Defaults to 0.75\n#' @param weights Optional weights for each case.\n#' @param verbose\n#'\n#'\n#'\n#' @export\n\n\n\nstable = function(formula,\n                 data,\n                 methods=c(\"lm\",\"rpart\",\"tree\",\"ctree\",\"evtree\"),\n                 samp.method=\"repeatedcv\",\n                 tuneLength=3,\n                 n.rep=100,\n                 stablelearner=FALSE,\n                 subset=FALSE,\n                 perc.sub=.75,\n                 weights=NULL,\n                 verbose=FALSE){\n\n  res <- list()\n\n  if(stablelearner==FALSE){\n    for(i in 1:n.rep){\n      set.seed(i)\n      print(i)\n      ids <- sample(nrow(data),nrow(data),replace=TRUE)\n      out[[i]] <- dtree(formula,data[ids,],methods,samp.method,\n                        tuneLength,subset,perc.sub,prune,weights,verbose)$return.matrix\n    }\n    ret <- array(NA, dim=c(n.rep,length(methods),ncol(out[[1]])))\n\n    for(j in 1:n.rep){\n      ret[j,,] <- out[[j]]\n    }\n\n    ret.mean <- apply(ret,3,colMeans,na.rm=TRUE)\n    ret.var <- apply(ret,3,matrixStats::colVars,na.rm=TRUE)\n\n    ret.mean <- matrix(ret.mean,length(methods),7)\n    ret.var <- matrix(ret.var,length(methods),7)\n\n    row.names(ret.mean) <- methods\n    row.names(ret.var) <- methods\n\n    colnames(ret.mean) <- colnames(out[[i]])\n    colnames(ret.var) <- colnames(out[[i]])\n\n\n\n    res$means <- round(ret.mean,3)\n    res$variances <- round(ret.var,3)\n    res\n  }else{\n    methods2=methods\n    if(any(methods2==c(\"lm\",\"rf\"))) stop(\"only decision tree methods can be used with stable learner\")\n\n    trees <- dtree(formula,data,methods=methods2,samp.method,\n          tuneLength,subset,perc.sub,prune,weights,verbose)\n\n\n    if(any(methods2==c(\"rpart\"))){\n      formula2 <- terms(formula,data=data)\n      tree1 <- rpart(formula(formula2),data)\n      tree2 <- prune(tree1,cp=as.numeric(trees$rpart.train$bestTune))\n      res$rpart <- stablelearner::stabletree(tree2,data=data,B=100)\n    }\n\n    if(any(methods2==c(\"ctree\"))){\n     # formula2 <- terms(formula,data=data)\n      #val = 1-as.numeric(trees$ctree.train$bestTune)\n      #ctrl=ctree_control()#(mincriterion=val)\n     # treet <- partykit::ctree(formula(formula2),data=data)#,control=ctrl)\n     # res$ctree <- stablelearner::stabletree(treet,data=data,formula=formula(formula2))\n      tt = train(default ~ ., data=Default,method=\"ctree\")\n      tree1 <- partykit::ctree(default ~ income, data=Default,\n                               control=ctree_control(mincriterion=as.numeric(tt$bestTune)))\n     stablelearner::stabletree(tree1)\n    }\n\n    if(any(methods2==c(\"evtree\"))){\n      tree <- dtree(formula,data,methods=\"evtree\",samp.method,\n                    tuneLength,subset,perc.sub,prune,weights,verbose)$evtree.out\n      res$evtree <- stablelearner::stabletree(tree,data=data,B=100)\n    }\n\n\n  }\n\n\n\nreturn(res)\n\n\n}\n",
    "created" : 1490195270484.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1570905052",
    "id" : "D49B51AC",
    "lastKnownWriteTime" : 1490205274,
    "last_content_update" : 1490205274525,
    "path" : "~/GitHub/dtree/R/stable.R",
    "project_path" : "R/stable.R",
    "properties" : {
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}